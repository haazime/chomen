var autoSaveWait = <%= Rails.env == 'test' ? 1 : 2000 %>;

var autoSaveTimeoutIds = {};
var submitForm = function(form) {
  var n = $(form).find('input[name="chunk[number]"]').val();
  if (autoSaveTimeoutIds[n]) clearTimeout(autoSaveTimeoutIds[n]);
  autoSaveTimeoutIds[n] = setTimeout(function() {
    $.rails.handleRemote(form);
  }, autoSaveWait);
}

var autoSaveHandler = function() {
  $(document).on('input', 'textarea[data-auto-save]', function() {
    $.each($(this), function(i, textarea) {
      var form = $(textarea).closest('form');
      submitForm(form);
    })
  });
}

var autoSaveWait = <%= Rails.env == 'test' ? 1 : 2000 %>;

var autoSaveTimeoutIds = {};
var submitForm = function(form) {
  var key = $(form).find('input[name="chunk[gcid]"]').val();

  var timeoutId = autoSaveTimeoutIds[key];
  if (timeoutId) {
    clearTimeout(timeoutId);
  }

  autoSaveTimeoutIds[key] = setTimeout(function() {
    $.rails.handleRemote(form);
  }, autoSaveWait);
};

var autoSaveHandler = function() {
  $(document).on('input', 'textarea[data-auto-save]', function() {
    $.each($(this), function(i, textarea) {
      var form = $(textarea).closest('form');
      submitForm(form);
    })
  });
};
